<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOMA 5 | PAINEL EXECUTIVO</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
    <style>
        :root { --bg-deep: #000000; --bg-card: #0a0a0a; --accent: #ffffff; --border: #1f1f1f; --text-main: #ffffff; --text-dim: #888888; }
        body { font-family: 'Inter', sans-serif; margin: 0; background-color: var(--bg-deep); color: var(--text-main); display: flex; min-height: 100vh; }
        
        /* Sidebar */
        .sidebar { width: 260px; background: var(--bg-card); border-right: 1px solid var(--border); padding: 40px 20px; position: fixed; height: 100vh; }
        .logo { font-weight: 700; font-size: 1.5rem; letter-spacing: -1px; margin-bottom: 50px; display: block; text-decoration: none; color: var(--text-main); }
        .nav-link { color: var(--text-dim); text-decoration: none; display: block; padding: 12px 0; font-size: 0.9rem; transition: 0.3s; }
        .nav-link:hover { color: var(--accent); }
        
        /* Main Content */
        .main-content { margin-left: 260px; padding: 60px; width: 100%; }
        h1 { font-weight: 600; font-size: 2rem; margin-bottom: 40px; }
        
        /* Card de Cadastro */
        .glass-card { background: var(--bg-card); border: 1px solid var(--border); border-radius: 16px; padding: 32px; max-width: 800px; margin-bottom: 50px; }
        .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 24px; }
        .input-group { display: flex; flex-direction: column; }
        
        label { font-size: 0.7rem; text-transform: uppercase; letter-spacing: 1px; color: var(--text-dim); margin-bottom: 8px; }
        input, textarea { background: transparent; border: 1px solid var(--border); padding: 14px; border-radius: 8px; color: #fff; font-family: inherit; }
        input:focus, textarea:focus { border-color: var(--accent); outline: none; }
        
        /* Botão Principal */
        .btn-primary { grid-column: span 2; background: var(--accent); color: #000; border: none; padding: 16px; border-radius: 8px; font-weight: 700; cursor: pointer; text-transform: uppercase; transition: 0.3s; }
        .btn-primary:hover { opacity: 0.8; transform: translateY(-2px); }
        
        /* Tabela */
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th { text-align: left; color: var(--text-dim); font-size: 0.7rem; text-transform: uppercase; padding: 15px; border-bottom: 1px solid var(--border); }
        td { padding: 20px 15px; border-bottom: 1px solid var(--border); font-size: 0.95rem; }
        .img-car { width: 100px; height: 60px; object-fit: cover; border-radius: 8px; }
        .btn-del { background: transparent; color: #ff4444; border: 1px solid #ff444433; padding: 8px 16px; border-radius: 6px; cursor: pointer; }
    </style>
</head>
<body>

    <aside class="sidebar">
        <a href="#" class="logo">SOMA 5</a>
        <nav>
            <a href="index.html" target="_blank" class="nav-link">Página da Loja</a>
            <a href="#" class="nav-link" style="color: #fff;">Gestão de Estoque</a>
        </nav>
    </aside>

    <main class="main-content">
        <h1>Dashboard de Inventário</h1>

        <div class="glass-card">
            <div class="form-grid">
                <div class="input-group"><label>Marca</label><input type="text" id="marca"></div>
                <div class="input-group"><label>Modelo</label><input type="text" id="modelo"></div>
                <div class="input-group"><label>Ano</label><input type="number" id="ano"></div>
                <div class="input-group">
                    <label>Preço</label>
                    <input type="text" id="precoDisplay" placeholder="R$ 0,00" oninput="formatarMoeda(this)">
                </div>
                
                <div class="input-group" style="grid-column: span 2;">
                    <label>Detalhes do Veículo</label>
                    <textarea id="descricao" rows="3" placeholder="Ex: Teto solar, Único dono..."></textarea>
                </div>
                
                <div class="input-group" style="grid-column: span 2;">
                    <label>Upload da Foto</label>
                    <input type="file" id="fotoArquivo" accept="image/*">
                </div>
                
                <button class="btn-primary" onclick="enviarDados()">Adicionar ao Estoque</button>
            </div>
        </div>

        <table>
            <thead>
                <tr><th>Foto</th><th>Especificações</th><th>Valor</th><th>Ações</th></tr>
            </thead>
            <tbody id="tabela-corpo"></tbody>
        </table>
    </main>

    <script>
        const API = '/api/carros';

        // MÁSCARA DE MOEDA (PASSO 2)
        function formatarMoeda(input) {
            let valor = input.value.replace(/\D/g, '');
            valor = (valor / 100).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
            input.value = valor;
        }

        // Função para converter "R$ 35.000,00" de volta para 35000.00
        function limparFormatacao(valor) {
            return parseFloat(valor.replace(/\D/g, '')) / 100;
        }

        async function carregar() {
            const res = await fetch(API);
            const carros = await res.json();
            const corpo = document.getElementById('tabela-corpo');
            corpo.innerHTML = '';
            carros.forEach(c => {
                corpo.innerHTML += `
                    <tr>
                        <td><img src="${c.linkImagem}" class="img-car" onerror="this.src='https://via.placeholder.com/100x60/111/fff?text=SOMA5'"></td>
                        <td><b>${c.marca} ${c.modelo}</b><br><small style="color:#666">${c.ano}</small></td>
                        <td>R$ ${(c.preco || 0).toLocaleString('pt-BR')}</td>
                        <td><button class="btn-del" onclick="excluir(${c.id})">Remover</button></td>
                    </tr>`;
            });
        }

        async function enviarDados() {
            const foto = document.getElementById('fotoArquivo').files[0];
            const precoFormatado = document.getElementById('precoDisplay').value;

            if (!foto || !precoFormatado) return alert("Preencha todos os campos obrigatórios!");

            const formData = new FormData();
            formData.append("marca", document.getElementById('marca').value);
            formData.append("modelo", document.getElementById('modelo').value);
            formData.append("ano", document.getElementById('ano').value);
            formData.append("preco", limparFormatacao(precoFormatado)); // Envia o número limpo
            formData.append("descricao", document.getElementById('descricao').value);
            formData.append("foto", foto);

            const res = await fetch(API + '/com-foto', { method: 'POST', body: formData });
            if (res.ok) location.reload();
            else alert("Erro ao salvar no servidor.");
        }

        async function excluir(id) {
            if(confirm("Deseja remover este veículo do estoque?")) { 
                await fetch(`${API}/${id}`, { method: 'DELETE' }); 
                carregar(); 
            }
        }

        carregar();
    </script>
</body>
</html>